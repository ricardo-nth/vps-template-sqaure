---
import Icon from './Icon.astro';

interface Step {
  title: string;
  description: string;
  status: 'completed' | 'current' | 'upcoming';
  date?: string;
}

interface Props {
  heading?: string;
  subheading?: string;
  steps?: Step[];
}

const {
  heading = "Our Path to CQC Registration",
  subheading = "We are committed to full regulatory compliance and transparency as we work towards becoming a registered Supported Living provider.",
  steps = [
    {
      title: "Policy & Procedure Development",
      description: "Establishing robust governance frameworks, safeguarding protocols, and operational policies aligned with CQC Key Lines of Enquiry.",
      status: "completed",
      date: "Completed Q3 2024"
    },
    {
      title: "Team Recruitment & Training",
      description: "Assembling a highly qualified leadership team and care staff, ensuring DBS checks and mandatory training are in place.",
      status: "completed",
      date: "Completed Q4 2024"
    },
    {
      title: "Application Submission",
      description: "Submitting our comprehensive provider application to the Care Quality Commission, demonstrating our fitness to provide regulated activities.",
      status: "current",
      date: "In Progress"
    },
    {
      title: "Fit Person Interview",
      description: "Our Registered Manager demonstrates their skills, knowledge, and experience to the CQC inspector.",
      status: "upcoming"
    },
    {
      title: "Registration Granted",
      description: "Official confirmation of our status as a CQC-registered provider, allowing us to deliver regulated personal care.",
      status: "upcoming"
    }
  ]
} = Astro.props as Props;
---

<section class="py-24 bg-secondary/30" id="cqc-journey">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center mb-16">
      <p class="text-sm font-bold uppercase tracking-widest text-primary mb-3">
        Registration Status
      </p>
      <h2 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-foreground tracking-tight text-balance mb-6 font-serif">{heading}</h2>
      <p class="text-lg text-muted-foreground">{subheading}</p>
    </div>

    <div class="relative">
      {/* Vertical Line */}
      <div class="absolute left-8 top-0 bottom-0 w-0.5 bg-border md:left-1/2 md:-ml-px"></div>

      <div class="space-y-12">
        {steps.map((step, index) => (
          <div class={`relative flex items-start md:items-center gap-8 ${index % 2 === 0 ? 'md:flex-row-reverse' : ''}`}>
            
            {/* Timeline Dot */}
            <div class={`absolute left-8 -translate-x-1/2 md:left-1/2 flex items-center justify-center w-8 h-8 rounded-full border-4 border-background z-10 
              ${step.status === 'completed' ? 'bg-primary text-primary-foreground' : 
                step.status === 'current' ? 'bg-accent text-accent-foreground ring-4 ring-accent/20' : 
                'bg-muted text-muted-foreground'}`}>
              {step.status === 'completed' && <Icon name="tabler:check" class="w-4 h-4" />}
              {step.status === 'current' && <div class="w-2.5 h-2.5 rounded-full bg-current animate-pulse"></div>}
              {step.status === 'upcoming' && <div class="w-2.5 h-2.5 rounded-full bg-current"></div>}
            </div>

            {/* Content Card */}
            <div class="flex-1 ml-12 md:ml-0">
              <div class={`bg-card border border-border p-6 shadow-sm hover:shadow-md transition-shadow duration-300 
                ${step.status === 'current' ? 'border-primary/50 ring-1 ring-primary/20' : ''}`}>
                <div class="flex flex-col gap-2 mb-2">
                  <div class="flex items-center justify-between">
                    <span class={`text-xs font-bold uppercase tracking-wider 
                      ${step.status === 'completed' ? 'text-primary' : 
                        step.status === 'current' ? 'text-accent' : 'text-muted-foreground'}`}>
                      {step.status}
                    </span>
                    {step.date && <span class="text-xs text-muted-foreground font-medium">{step.date}</span>}
                  </div>
                  <h3 class="text-xl font-bold text-foreground">{step.title}</h3>
                </div>
                <p class="text-muted-foreground text-sm leading-relaxed">
                  {step.description}
                </p>
              </div>
            </div>
            
            {/* Spacer for alternating layout on desktop */}
            <div class="hidden md:block flex-1"></div>
          </div>
        ))}
      </div>
    </div>
  </div>
</section>